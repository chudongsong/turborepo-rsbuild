# LinglongOS API Service - 日志管理配置

## 日志轮转配置

本服务已配置日志轮转功能，防止日志文件无限增长：

### 配置参数
- **最大文件大小**: 50MB
- **备份文件数量**: 5个
- **检查间隔**: 每小时
- **日志目录**: `apps/api-service/logs/`

### 日志文件类型
- `egg-web.log` - Web请求日志
- `egg-agent.log` - Agent进程日志
- `common-error.log` - 错误日志
- `egg-schedule.log` - 定时任务日志

## 自动清理脚本

### 清理脚本位置
```bash
scripts/cleanup-logs.sh
```

### 使用方法
```bash
# 手动执行清理
bash scripts/cleanup-logs.sh

# 指定自定义日志目录
bash scripts/cleanup-logs.sh /path/to/custom/logs
```

### 定时任务配置 (macOS/Linux)
在crontab中添加：
```bash
# 每天凌晨2点执行日志清理
0 2 * * * /path/to/apps/api-service/scripts/cleanup-logs.sh >> /var/log/linglong-log-cleanup.log 2>&1
```

### 配置文件配置
环境变量可以通过以下方式设置：

```bash
# 设置日志目录
export LOG_DIR=/path/to/logs

# 设置日志级别
export LOG_LEVEL=INFO
```

## 日志文件大小限制

| 文件类型 | 大小限制 | 备份文件数 |
|---------|----------|------------|
| Web日志 | 50MB | 5个 |
| 错误日志 | 50MB | 5个 |
| Agent日志 | 50MB | 5个 |
| 调度日志 | 50MB | 5个 |

## 监控建议

### 磁盘空间监控
定期检查日志目录占用的磁盘空间：

```bash
du -h apps/api-service/logs/
```

### 日志级别配置
生产环境建议使用 `WARN` 或 `ERROR` 级别减少日志量：

```bash
export LOG_LEVEL=WARN
```

### 日志轮转检查
定期验证日志轮转是否正常工作：

```bash
ls -lh apps/api-service/logs/@linglongos/api-service/
```

## 故障排除

### 如果日志文件仍然过大
1. 检查日志轮转配置是否生效
2. 手动执行清理脚本
3. 调整日志级别设置
4. 检查是否有异常错误的日志输出

### 日志文件权限问题
确保日志目录有适当的写入权限：

```bash
chmod 755 apps/api-service/logs/
chown -R $(whoami) apps/api-service/logs/
```

## 相关配置

- `config/config.default.ts` - 主要日志配置
- `scripts/cleanup-logs.sh` - 清理脚本
- `.gitignore` - 排除日志文件提交