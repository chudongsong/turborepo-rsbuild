# 01-æ„å»ºé…ç½®è¯´æ˜

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº† desktop-app åº”ç”¨çš„æ„å»ºç³»ç»Ÿé…ç½®ï¼ŒåŒ…æ‹¬ Rsbuild é…ç½®ã€TypeScript é…ç½®ã€æ„å»ºè„šæœ¬ç­‰ã€‚

## ğŸ› ï¸ æ„å»ºç³»ç»Ÿæ¦‚è§ˆ

Desktop-app é‡‡ç”¨ç°ä»£åŒ–çš„æ„å»ºå·¥å…·é“¾ï¼Œæä¾›é«˜æ€§èƒ½çš„å¼€å‘ä½“éªŒå’Œä¼˜åŒ–çš„ç”Ÿäº§æ„å»ºã€‚

### æ ¸å¿ƒæ„å»ºå·¥å…·
- **Rsbuild**: åŸºäº Rust çš„é«˜æ€§èƒ½æ„å»ºå·¥å…·
- **TypeScript**: ç±»å‹æ£€æŸ¥å’Œç¼–è¯‘
- **Vite**: å¼€å‘æœåŠ¡å™¨å’Œ HMR
- **pnpm**: åŒ…ç®¡ç†å’Œå·¥ä½œåŒºé›†æˆ

## ğŸ“‹ æ„å»ºé…ç½®æ–‡ä»¶

### 1. Rsbuild é…ç½® (rsbuild.config.ts)

```typescript
import { defineConfig } from '@rsbuild/core';
import { pluginReact } from '@rsbuild/plugin-react';
import { pluginSvgr } from '@rsbuild/plugin-svgr';

export default defineConfig({
  // æ ¹ç›®å½•
  root: __dirname,
  
  // ç¯å¢ƒé…ç½®
  environments: {
    // å¼€å‘ç¯å¢ƒ
    development: {
      dev: {
        port: 3001,
        host: 'localhost',
        hmr: {
          overlay: true,
        },
      },
      output: {
        path: 'dist-dev',
      },
    },
    
    // ç”Ÿäº§ç¯å¢ƒ
    production: {
      build: {
        minify: 'terser',
        target: 'es2018',
        sourceMap: {
          enabled: false,
        },
      },
      output: {
        path: 'dist',
        filename: {
          js: 'js/[name].[contenthash:8].js',
          css: 'css/[name].[contenthash:8].css',
        },
      },
    },
  },
  
  // æ’ä»¶é…ç½®
  plugins: [
    pluginReact({
      // React é…ç½®
      react: {
        development: true,
        refresh: true,
      },
      
      // æ–‡ä»¶æ‰©å±•å
      extensions: {
        jsx: true,
        tsx: true,
      },
      
      // CSS å¤„ç†
      css: {
        modules: {
          auto: true,
        },
      },
    }),
    
    pluginSvgr({
      // SVG é…ç½®
      svgr: {
        exportType: 'named',
        nameTemplate: '[name]-[hash][extname]',
        svgoConfig: {
          plugins: [
            {
              name: 'removeAttrs',
              params: {
                attrs: '(data-name)',
              },
            },
          ],
        },
      },
    }),
  ],
  
  // æºæ–‡ä»¶é…ç½®
  source: {
    // å…¥å£æ–‡ä»¶
    entry: {
      main: './src/main.tsx',
    },
    
    // åŒ…å«ç›®å½•
    include: ['src/**/*', 'public/**/*'],
    
    // æ’é™¤ç›®å½•
    exclude: ['src/**/*.test.*', 'src/**/*.spec.*', 'src/__tests__/**/*'],
    
    // æ¨¡å—è§£æ
    resolve: {
      extensions: ['.tsx', '.ts', '.js', '.jsx', '.css'],
      alias: {
        '@': 'src',
        '@components': 'src/components',
        '@hooks': 'src/hooks',
        '@services': 'src/services',
        '@store': 'src/store',
        '@types': 'src/types',
        '@utils': 'src/utils',
      },
    },
  },
  
  // æ€§èƒ½ä¼˜åŒ–
  performance: {
    // ä»£ç åˆ†å‰²
    chunks: {
      strategy: 'split-by-experience',
      prioritizeEntry: true,
      autoDetectRegExp: [/./],
      manualChunks: undefined,
    },
    
    // èµ„æºå‹ç¼©
    bundleAnalyze: {
      analyzerMode: 'static',
      analyzerHost: 'localhost',
      analyzerPort: 3002,
      openAnalyzer: true,
    },
    
    // é¢„åŠ è½½
    preload: {
      // å…³é”®èµ„æºé¢„åŠ è½½
      prefetch: {
        import: true,
        font: true,
        image: true,
        media: true,
      },
      
      // å…³é”®èµ„æºé¢„è¿æ¥
      preconnect: {
        origin: ['https://fonts.googleapis.com'],
        crossorigin: true,
      },
    },
  },
  
  // HTML é…ç½®
  html: {
    template: 'public/index.html',
    templateParameters: {
      // åŸºç¡€ä¿¡æ¯
      title: 'Linglong Desktop',
      description: 'ç°ä»£åŒ–æ¡Œé¢åº”ç”¨',
      
      // ç¯å¢ƒå˜é‡
      VITE_APP_VERSION: process.env.VITE_APP_VERSION,
      VITE_API_BASE_URL: process.env.VITE_API_BASE_URL,
      
      // CDN é…ç½®
      CDN_BASE_URL: process.env.VITE_CDN_BASE_URL,
      
      // åŠŸèƒ½å¼€å…³
      FEATURE_ENABLE_DEVTOOLS: process.env.NODE_ENV === 'development',
    },
  },
  
  // è¾“å‡ºé…ç½®
  output: {
    // é™æ€èµ„æºç›®å½•
    assetsPath: 'assets',
    
    // é™æ€æ–‡ä»¶å¤„ç†
    filenameHashing: true,
    
    // CSS æ–‡ä»¶å
    cssFilename: 'css/[name].[contenthash:8].css',
    
    // JavaScript æ–‡ä»¶å
    jsFilename: 'js/[name].[contenthash:8].js',
    
    // èµ„æºå†…è”
    inlineStyles: (resourcePath) => {
      return resourcePath.includes('critical.css');
    },
    
    // èµ„æºå‹ç¼©
    minify: 'terser',
    
    // Source Map
    sourceMap: {
      enabled: process.env.NODE_ENV === 'development',
      inline: false,
      url: 'inline',
    },
  },
  
  // CSS é…ç½®
  css: {
    // CSS Modules
    modules: {
      localsConvention: 'camelCase',
    },
    
    // PostCSS é…ç½®
    postcss: {
      plugins: [
        // Tailwind CSS
        require('tailwindcss'),
        require('autoprefixer'),
        
        // CSS ä¼˜åŒ–
        require('cssnano')({
          preset: 'default',
        }),
      ],
    },
    
    // é¢„å¤„ç†å™¨
    preprocessor: {
      scss: {
        includePaths: ['src', 'node_modules'],
      },
    },
  },
  
  // å·¥å…·é“¾é…ç½®
  tools: {
    // TypeScript é…ç½®
    typescript: {
      // ç±»å‹æ£€æŸ¥
      typeCheckMode: 'BuildRequired',
      
      // ä¸¥æ ¼æ¨¡å¼
      strict: true,
      
      // å¢é‡ç¼–è¯‘
      incremental: true,
    },
    
    // ESLint/BIOME é…ç½®
    biome: {
      // é…ç½®æ–‡ä»¶è·¯å¾„
      configPath: 'biome.json',
    },
    
    // Webpack é…ç½®å…¼å®¹æ€§
    webpack: {
      // æ”¯æŒ CSS Modules
      loader: {
        'css-loader': {
          options: {
            modules: {
              auto: true,
              exportGlobals: true,
            },
          },
        },
      },
    },
  },
  
  // å¼€å‘æœåŠ¡å™¨é…ç½®
  devServer: {
    // æœåŠ¡å™¨é€‰é¡¹
    devMiddleware: {
      writeToDisk: false,
      headers: {
        'Access-Control-Allow-Origin': '*',
      },
    },
    
    // ä»£ç†é…ç½®
    proxy: {
      // API ä»£ç†
      '/api': {
        target: 'http://localhost:4000',
        changeOrigin: true,
        secure: false,
      },
      
      // é™æ€èµ„æºä»£ç†
      '/assets': {
        target: 'http://localhost:4000',
        changeOrigin: true,
        secure: false,
      },
    },
    
    // çƒ­æ›´æ–°é…ç½®
    hot: {
      port: 3001,
      host: 'localhost',
    },
  },
  
  // æ„å»ºä¼˜åŒ–
  optimization: {
    // æ‘‡æ ‘ä¼˜åŒ–
    treeShaking: true,
    
    // ä»£ç åˆ†å‰²
    splitChunks: {
      chunks: 'all',
      cacheGroups: {
        // React ç›¸å…³åº“
        vendor: {
          test: /[\\/]node_modules[\\/]react/,
          name: 'vendors-react',
          chunks: 'all',
          priority: 20,
        },
        
        // UI åº“
        ui: {
          test: /[\\/]node_modules[\\/](@radix-ui|@hookform|@react-dnd)/,
          name: 'vendors-ui',
          chunks: 'all',
          priority: 15,
        },
        
        // å·¥å…·åº“
        utils: {
          test: /[\\/]node_modules[\\/](lodash|axios|uuid)/,
          name: 'vendors-utils',
          chunks: 'all',
          priority: 10,
        },
        
        // æ¡Œé¢ç‰¹å®šä»£ç 
        desktop: {
          test: /[\\/]src[\\/](features|hooks|services)/,
          name: 'desktop-core',
          chunks: 'all',
          priority: 5,
        },
      },
    },
    
    // è¿è¡Œæ—¶é…ç½®
    runtime: 'main',
    
    // ç›®æ ‡ç¯å¢ƒ
    target: 'web',
  },
  
  // ç›‘æ§é…ç½®
  monitoring: {
    // æ„å»ºç›‘æ§
    build: {
      enabled: true,
      metrics: {
        buildTime: true,
        bundleSize: true,
        dependencies: true,
      },
    },
    
    // æ€§èƒ½ç›‘æ§
    performance: {
      enabled: true,
      monitor: {
        coreWebVitals: true,
        longTasks: true,
        memoryUsage: true,
      },
    },
  },
  
  // éƒ¨ç½²é…ç½®
  deployment: {
    // æ„å»ºäº§ç‰©
    artifacts: [
      'dist/**/*',
      'package.json',
      'README.md',
    ],
    
    // éƒ¨ç½²è„šæœ¬
    scripts: {
      prebuild: [
        'npm run clean',
        'npm run test:unit',
        'npm run lint',
      ],
      
      postbuild: [
        'npm run build:analyze',
        'npm run build:stats',
      ],
    },
    
    // ç¯å¢ƒå˜é‡
    environment: {
      development: '.env.development',
      staging: '.env.staging',
      production: '.env.production',
    },
  },
});
```

### 2. TypeScript é…ç½® (tsconfig.json)

```json
{
  "compilerOptions": {
    // åŸºç¡€é…ç½®
    "target": "ES2020",
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "moduleResolution": "node",
    
    // è§£æé€‰é¡¹
    "allowJs": false,
    "checkJs": false,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "esModuleInterop": true,
    "forceConsistentCasingInFileNames": true,
    "allowSyntheticDefaultImports": true,
    "skipLibCheck": true,
    
    // ä¸¥æ ¼ç±»å‹æ£€æŸ¥
    "strict": true,
    "noImplicitAny": true,
    "strictNullChecks": true,
    "strictFunctionTypes": true,
    "strictBindCallApply": true,
    "strictPropertyInitialization": true,
    "noImplicitThis": true,
    "alwaysStrict": true,
    
    // é¢å¤–æ£€æŸ¥
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "exactOptionalPropertyTypes": true,
    "noImplicitReturns": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedIndexedAccess": true,
    "noImplicitOverride": true,
    "noPropertyAccessFromIndexSignature": true,
    
    // æ¨¡å—è§£æ
    "allowImportingTsExtensions": true,
    "noEmit": true,
    "allowSyntheticDefaultImports": true,
    "esModuleInterop": true,
    
    // å®éªŒæ€§åŠŸèƒ½
    "experimentalDecorators": true,
    "emitDecoratorMetadata": true,
    
    // è·¯å¾„æ˜ å°„
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"],
      "@components/*": ["src/components/*"],
      "@hooks/*": ["src/hooks/*"],
      "@services/*": ["src/services/*"],
      "@store/*": ["src/store/*"],
      "@types/*": ["src/types/*"],
      "@utils/*": ["src/utils/*"]
    },
    
    // è¾“å‡ºé…ç½®
    "outDir": "./dist",
    "rootDir": "./src",
    
    // å£°æ˜æ–‡ä»¶
    "declaration": true,
    "declarationMap": true,
    "emitDeclarationOnly": false,
    
    // æºç æ˜ å°„
    "sourceMap": true,
    "inlineSources": true,
    "mapRoot": "./",
    
    // æ„å»ºé€‰é¡¹
    "incremental": true,
    "tsBuildInfoFile": "./dist/.tsbuildinfo",
    
    // è¿‡æ»¤å™¨
    "include": [
      "src/**/*",
      "public/**/*",
      "*.config.*",
      "*.d.ts"
    ],
    "exclude": [
      "dist/**/*",
      "node_modules/**/*",
      "src/**/*.test.*",
      "src/**/*.spec.*",
      "src/__tests__/**/*"
    ]
  },
  
  // é¡¹ç›®å¼•ç”¨
  "references": [
    {
      "path": "./tsconfig.app.json"
    },
    {
      "path": "./tsconfig.node.json"
    }
  ]
}
```

### 3. TypeScript åº”ç”¨é…ç½® (tsconfig.app.json)

```json
{
  "compilerOptions": {
    "composite": true,
    "tsBuildInfoFile": "./dist/.tsbuildinfo.app",
    
    // å…è®¸çš„ JavaScript åº“
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    
    // ä¸¥æ ¼ç±»å‹æ£€æŸ¥
    "strict": true,
    "noImplicitAny": true,
    "strictNullChecks": true,
    "strictFunctionTypes": true,
    "strictBindCallApply": true,
    "strictPropertyInitialization": true,
    "noImplicitThis": true,
    "alwaysStrict": true,
    
    // é¢å¤–æ£€æŸ¥
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "exactOptionalPropertyTypes": true,
    "noImplicitReturns": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedIndexedAccess": true,
    "noImplicitOverride": true,
    "noPropertyAccessFromIndexSignature": true,
    
    // æ¨¡å—è§£æ
    "module": "ESNext",
    "moduleResolution": "node",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "allowSyntheticDefaultImports": true,
    "esModuleInterop": true,
    
    // TypeScript React é…ç½®
    "jsx": "react-jsx",
    "jsxImportSource": "@emotion/react",
    
    // è£…é¥°å™¨
    "experimentalDecorators": true,
    "emitDecoratorMetadata": true,
    
    // è·¯å¾„æ˜ å°„
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"],
      "@components/*": ["src/components/*"],
      "@hooks/*": ["src/hooks/*"],
      "@services/*": ["src/services/*"],
      "@store/*": ["src/store/*"],
      "@types/*": ["src/types/*"],
      "@utils/*": ["src/utils/*"]
    }
  },
  
  "include": [
    "src/**/*",
    "public/**/*"
  ],
  
  "exclude": [
    "node_modules/**/*",
    "dist/**/*",
    "src/**/*.test.*",
    "src/**/*.spec.*",
    "src/__tests__/**/*"
  ]
}
```

### 4. ç¯å¢ƒé…ç½®æ–‡ä»¶

#### .env.development
```bash
# å¼€å‘ç¯å¢ƒé…ç½®
NODE_ENV=development
VITE_APP_VERSION=0.1.0-dev
VITE_APP_NAME=Desktop App Dev

# API é…ç½®
VITE_API_BASE_URL=http://localhost:4000
VITE_API_TIMEOUT=30000

# å¼€å‘å·¥å…·
VITE_ENABLE_DEVTOOLS=true
VITE_ENABLE_MOCK_DATA=false
VITE_ENABLE_DEBUG=true

# æ€§èƒ½ç›‘æ§
VITE_ENABLE_PERFORMANCE_MONITORING=true
VITE_PERFORMANCE_MONITORING_SAMPLE_RATE=1.0

# ä¸»é¢˜é…ç½®
VITE_DEFAULT_THEME=light
VITE_ENABLE_THEME_SWITCHING=true

# æ’ä»¶ç³»ç»Ÿ
VITE_ENABLE_PLUGINS=true
VITE_PLUGIN_AUTO_LOAD=true
VITE_PLUGIN_DIR=/plugins

# æ‹–æ‹½é…ç½®
VITE_ENABLE_DND=true
VITE_DND_ANIMATION=true
VITE_DND_SNAP_TO_GRID=true

# çª—å£ç®¡ç†
VITE_DEFAULT_WINDOW_SIZE=800x600
VITE_WINDOW_MIN_SIZE=400x300
VITE_WINDOW_ANIMATIONS=true

# ç¼“å­˜é…ç½®
VITE_CACHE_ENABLED=true
VITE_CACHE_VERSION=v1

# æ„å»ºé…ç½®
VITE_BUILD_ANALYZE=false
VITE_BUILD_SOURCE_MAP=true
```

#### .env.production
```bash
# ç”Ÿäº§ç¯å¢ƒé…ç½®
NODE_ENV=production
VITE_APP_VERSION=0.1.0
VITE_APP_NAME=Desktop App

# API é…ç½®
VITE_API_BASE_URL=https://api.example.com
VITE_API_TIMEOUT=15000

# æ€§èƒ½é…ç½®
VITE_ENABLE_DEVTOOLS=false
VITE_ENABLE_MOCK_DATA=false
VITE_ENABLE_DEBUG=false

# æ€§èƒ½ç›‘æ§
VITE_ENABLE_PERFORMANCE_MONITORING=true
VITE_PERFORMANCE_MONITORING_SAMPLE_RATE=0.1

# æ„å»ºä¼˜åŒ–
VITE_BUILD_ANALYZE=false
VITE_BUILD_SOURCE_MAP=false
VITE_CACHE_ENABLED=true
VITE_CACHE_VERSION=v1.0

# CDN é…ç½®
VITE_CDN_BASE_URL=https://cdn.example.com
VITE_STATIC_ASSETS_URL=https://static.example.com

# å®‰å…¨é…ç½®
VITE_ENABLE_SECURITY_HEADERS=true
VITE_ENABLE_CSP=true
```

### 5. æ„å»ºè„šæœ¬ (package.json)

```json
{
  "scripts": {
    // å¼€å‘å‘½ä»¤
    "dev": "rsbuild dev",
    "dev:open": "rsbuild dev --open",
    "dev:host": "rsbuild dev --host",
    "dev:debug": "rsbuild dev --debug",
    
    // æ„å»ºå‘½ä»¤
    "build": "run-p build:*",
    "build:clean": "rimraf dist dist-dev",
    "build:compile": "tsc -b",
    "build:rsbuild": "rsbuild build",
    "build:analyze": "rsbuild build --analyze",
    "build:stats": "rsbuild build --analyze --profile",
    "build:optimize": "node scripts/optimize-build.js",
    
    // é¢„è§ˆå‘½ä»¤
    "preview": "rsbuild preview",
    "preview:open": "rsbuild preview --open",
    
    // ç±»å‹æ£€æŸ¥
    "type-check": "tsc -b --noEmit",
    "type-check:watch": "tsc -b --noEmit --watch",
    
    // ä»£ç è´¨é‡
    "lint": "biome check ./",
    "lint:fix": "biome check --write ./",
    "lint:watch": "biome check --watch ./",
    
    // æ ¼å¼åŒ–
    "format": "biome format ./",
    "format:fix": "biome format --write ./",
    "format:check": "biome format --check ./",
    
    // ç»¼åˆæ£€æŸ¥
    "check": "run-p type-check lint",
    "check:fix": "run-p type-check lint:fix format:fix",
    
    // æµ‹è¯•ç›¸å…³
    "test": "vitest run",
    "test:watch": "vitest",
    "test:coverage": "vitest run --coverage",
    "test:ui": "vitest --ui",
    
    // æ¸…ç†å‘½ä»¤
    "clean": "run-p clean:*",
    "clean:build": "rimraf dist dist-dev",
    "clean:cache": "rimraf node_modules/.cache",
    "clean:coverage": "rimraf coverage",
    "clean:tsbuildinfo": "rimraf dist/.tsbuildinfo",
    
    // åŒ…åˆ†æ
    "analyze": "run-p analyze:*",
    "analyze:bundle": "rsbuild build --analyze",
    "analyze:deps": "npm run build && npx depcheck",
    "analyze:size": "npx bundlesize",
    
    // æ€§èƒ½æµ‹è¯•
    "perf": "run-p perf:*",
    "perf:lighthouse": "lighthouse http://localhost:3001 --output json --output-path reports/lighthouse.json",
    "perf:web-vitals": "node scripts/measure-web-vitals.js",
    
    // éƒ¨ç½²ç›¸å…³
    "deploy": "run-p deploy:*",
    "deploy:build": "npm run build",
    "deploy:check": "npm run check",
    "deploy:upload": "node scripts/deploy.js",
    
    // æ–‡æ¡£ç”Ÿæˆ
    "docs": "typedoc",
    "docs:build": "typedoc --out docs/typedoc",
    "docs:serve": "typedoc --watch --serve",
    
    // ä¾èµ–ç®¡ç†
    "deps": "run-p deps:*",
    "deps:update": "pnpm update",
    "deps:audit": "pnpm audit",
    "deps:fix": "pnpm audit --fix",
    "deps:outdated": "pnpm outdated"
  }
}
```

## ğŸ”§ æ„å»ºä¼˜åŒ–ç­–ç•¥

### 1. ä»£ç åˆ†å‰²ä¼˜åŒ–

```javascript
// æ‰‹åŠ¨ä»£ç åˆ†å‰²é…ç½®
export default defineConfig({
  // è‡ªå®šä¹‰ä»£ç åˆ†å‰²è§„åˆ™
  splitChunks: {
    cacheGroups: {
      // æ¡Œé¢æ ¸å¿ƒåŠŸèƒ½
      desktop: {
        name: 'desktop-core',
        test: /[\\/]src[\\/](features|hooks|services)[\\/]/,
        chunks: 'all',
        priority: 10,
        minSize: 20000,
        maxSize: 244000,
        minChunks: 2,
        maxAsyncRequests: 5,
      },
      
      // çª—å£ç®¡ç†æ¨¡å—
      windows: {
        name: 'windows',
        test: /[\\/]src[\\/](components[\\/]WindowManager|slices[\\/]window)[\\/]/,
        chunks: 'all',
        priority: 15,
        minSize: 10000,
        maxSize: 512000,
      },
      
      // æ‹–æ‹½ç³»ç»Ÿ
      dnd: {
        name: 'dnd-system',
        test: /[\\/]src[\\/].*[Dd]rag[\\/]/,
        chunks: 'all',
        priority: 12,
      },
      
      // çŠ¶æ€ç®¡ç†
      store: {
        name: 'state-management',
        test: /[\\/]src[\\/]store[\\/]/,
        chunks: 'all',
        priority: 8,
      },
      
      // UI ç»„ä»¶
      components: {
        name: 'ui-components',
        test: /[\\/]src[\\/]components[\\/]ui[\\/]/,
        chunks: 'all',
        priority: 5,
      },
      
      // ç¬¬ä¸‰æ–¹åº“åˆ†ç»„
      vendors: {
        name: 'vendors',
        test: /[\\/]node_modules[\\/]/,
        chunks: 'all',
        priority: 2,
        minSize: 20000,
        maxSize: 512000,
        reuseExistingChunk: true,
      },
    },
  },
  
  // é¢„åŠ è½½ç­–ç•¥
  preload: {
    // å…³é”®è·¯å¾„é¢„åŠ è½½
    magicComments: true,
    
    // é¢„å–ç­–ç•¥
    prefetch: {
      strategy: 'all',
      include: ['desktop-core', 'windows'],
    },
  },
});
```

### 2. èµ„æºä¼˜åŒ–é…ç½®

```javascript
// å›¾ç‰‡ä¼˜åŒ–
export default defineConfig({
  assets: {
    // å›¾ç‰‡å¤„ç†
    inlineStyles: false,
    inlineFonts: true,
    
    // å­—ä½“ä¼˜åŒ–
    fontInlineFormats: ['woff2', 'woff'],
    fontAssetUrl: (assetPath) => {
      return `fonts/${assetPath}`;
    },
    
    // å›¾ç‰‡å‹ç¼©
    image: {
      format: ['webp', 'avif'],
      quality: 85,
      resize: {
        width: [256, 512, 1024],
        height: [256, 512, 1024],
      },
    },
  },
  
  // èµ„æºå†…è”
  minify: {
    // å›¾ç‰‡å†…è”é˜ˆå€¼ï¼ˆå°äº 10KB çš„å›¾ç‰‡å†…è”ï¼‰
    inlineAssets: {
      image: 10240,
      font: 10240,
    },
    
    // CSS å…³é”®æ ·å¼å†…è”
    criticalCSS: {
      enabled: true,
      inlineSize: 5120,
    },
  },
  
  // å‹ç¼©é…ç½®
  compression: {
    gzip: true,
    brotli: true,
    level: 6,
  },
});
```

### 3. æ€§èƒ½ç›‘æ§é…ç½®

```javascript
// æ€§èƒ½ç›‘æ§å·¥å…·
export default defineConfig({
  monitoring: {
    // æ„å»ºæ€§èƒ½ç›‘æ§
    build: {
      enabled: true,
      reportPath: './dist/build-report.json',
      
      // æ„å»ºæ—¶é—´ç›‘æ§
      buildTime: {
        threshold: 30000, // 30ç§’é˜ˆå€¼
        stages: [
          'compile',
          'bundle',
          'minify',
          'optimize',
        ],
      },
      
      // åŒ…å¤§å°ç›‘æ§
      bundleSize: {
        maxSize: 1024 * 1024, // 1MB
        maxChunks: 50,
        maxRequests: 200,
      },
      
      // ä¾èµ–åˆ†æ
      dependencies: {
        analysis: true,
        reportPath: './dist/dependency-report.json',
      },
    },
    
    // è¿è¡Œæ—¶æ€§èƒ½ç›‘æ§
    runtime: {
      enabled: process.env.NODE_ENV === 'development',
      
      // Web Vitals ç›‘æ§
      webVitals: {
        lcp: true,
        fid: true,
        cls: true,
        fcp: true,
        ttfb: true,
      },
      
      // å†…å­˜ä½¿ç”¨ç›‘æ§
      memory: {
        enabled: true,
        interval: 5000,
        threshold: 100 * 1024 * 1024, // 100MB
      },
      
      // æ¸²æŸ“æ€§èƒ½ç›‘æ§
      render: {
        enabled: true,
        fps: true,
        frameDrops: true,
        longTasks: true,
      },
    },
  },
});
```

## ğŸš€ éƒ¨ç½²é…ç½®

### 1. é™æ€æ‰˜ç®¡éƒ¨ç½²

```javascript
// éƒ¨ç½²é…ç½®æ–‡ä»¶
export default defineConfig({
  deployment: {
    // Vercel éƒ¨ç½²
    vercel: {
      buildCommand: 'npm run build',
      outputDirectory: 'dist',
      installCommand: 'npm install',
      framework: 'vite',
      functions: {
        'api/**/*.js': {
          runtime: 'nodejs18.x',
        },
      },
    },
    
    // Netlify éƒ¨ç½²
    netlify: {
      buildCommand: 'npm run build',
      publish: 'dist',
      headers: {
        '/*.js': {
          'Cache-Control': 'public, max-age=31536000, immutable',
        },
        '/*.css': {
          'Cache-Control': 'public, max-age=31536000, immutable',
        },
        '/': {
          'Cache-Control': 'public, max-age=0, must-revalidate',
        },
      },
    },
    
    // è‡ªå®šä¹‰éƒ¨ç½²è„šæœ¬
    custom: {
      buildCommand: 'npm run build',
      outputDirectory: 'dist',
      preDeployScript: 'npm run check',
      postDeployScript: 'node scripts/verify-deployment.js',
    },
  },
});
```

### 2. å®¹å™¨åŒ–éƒ¨ç½²

```dockerfile
# Dockerfile
FROM node:18-alpine AS builder

WORKDIR /app

# å®‰è£… pnpm
RUN npm install -g pnpm

# å¤åˆ¶åŒ…ç®¡ç†æ–‡ä»¶
COPY package.json pnpm-lock.yaml ./

# å®‰è£…ä¾èµ–
RUN pnpm install --frozen-lockfile

# å¤åˆ¶æºä»£ç 
COPY . .

# æ„å»ºåº”ç”¨
RUN pnpm run build

# ç”Ÿäº§ç¯å¢ƒé•œåƒ
FROM nginx:alpine

# å¤åˆ¶æ„å»ºäº§ç‰©
COPY --from=builder /app/dist /usr/share/nginx/html

# å¤åˆ¶ nginx é…ç½®
COPY nginx.conf /etc/nginx/nginx.conf

# æš´éœ²ç«¯å£
EXPOSE 80

# å¯åŠ¨ nginx
CMD ["nginx", "-g", "daemon off;"]
```

### 3. CI/CD æµæ°´çº¿

```yaml
# .github/workflows/build.yml
name: Build and Deploy

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  build:
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        node-version: [18, 20]
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: ${{ matrix.node-version }}
        
    - name: Setup pnpm
      uses: pnpm/action-setup@v2
      with:
        version: 8
        
    - name: Cache pnpm dependencies
      uses: actions/cache@v3
      with:
        path: ~/.pnpm-store
        key: ${{ runner.os }}-pnpm-${{ hashFiles('**/pnpm-lock.yaml') }}
        
    - name: Install dependencies
      run: pnpm install --frozen-lockfile
      
    - name: Type check
      run: pnpm type-check
      
    - name: Lint
      run: pnpm lint
      
    - name: Test
      run: pnpm test:coverage
      
    - name: Build
      run: pnpm build
      
    - name: Bundle analysis
      run: pnpm analyze:bundle
      
    - name: Upload build artifacts
      uses: actions/upload-artifact@v3
      with:
        name: dist-${{ matrix.node-version }}
        path: dist/
        
    - name: Upload test coverage
      uses: codecov/codecov-action@v3
      with:
        file: ./coverage/lcov.info
        
  deploy:
    needs: build
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
    - name: Download build artifacts
      uses: actions/download-artifact@v3
      with:
        name: dist-18
        path: dist/
        
    - name: Deploy to production
      run: |
        # éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
        echo "Deploying to production..."
        # å…·ä½“çš„éƒ¨ç½²è„šæœ¬
```

---

*æ›´å¤šæ„å»ºé…ç½®è¯¦æƒ…è¯·å‚è€ƒå…·ä½“çš„é…ç½®æ–‡ä»¶å’Œæ„å»ºè„šæœ¬ã€‚*